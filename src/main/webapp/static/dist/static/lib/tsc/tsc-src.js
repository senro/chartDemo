function didCallback(e){null!=e&&""!=e&&"null"!=e&&(clearInterval(tscSdkObj.p_device_id_time),tscSdkObj.setDeviceId(e))}function doGenTsc(e,t,n,i,a){tscSdkObj=new TSCObject(a),partnerCode="000",tscSdkObj.init(partnerCode,e,t,n,i),tscSdkObj.generateTscCode()}function showTime(){}function showStar(){}function doGenerateInternal(){var e=""+(new Date).getTime(),t=parseInt(e.substring(0,e.length-3))-g_PGS_TimeOffset,n=generateDynamicCode(g_PGS_DeviceId,t,g_PGS_UserToken,g_PGS_UserToken,g_PGS_PartCode,g_PGS_Version),i=g_PGS_Type+n;generateQRcode(i),jQuery("#qrcodeNum").text(i)}function generateQRcode(e){var t=256,n=256,i="#efefef",a="#424647";g_options.width&&(t=g_options.width),g_options.height&&(n=g_options.height),g_options.foreground&&(a=g_options.foreground),g_options.background&&(i=g_options.background),jQuery("#qrcodeCanvas").empty(),jQuery("#qrcodeCanvas").qrcode({width:t,height:n,background:i,foreground:a,text:e})}function doGenerate(e,t,n,i,a,s,r){g_PGS_Type=e,g_PGS_DeviceId=t,g_PGS_UserToken=n,g_PGS_PartCode=i,g_PGS_TimeOffset=a,g_PGS_Version=s,g_options=r,g_options||(g_options={});var d=setInterval(doGenerateInternal,1e3);return doGenerateInternal(),d}function generateToken(e,t,n){for(var i="",a=t+e+n,s=hex_md5(a),r=0,d=0;r<s.length&&6>d;){var c=s[r++];isNaN(c)||(i+=c,d++)}return i}function generateDynamicCode(e,t,n,i,a,s){if(8!=i.length)return null;var r=generateToken(e,t,n),d=i+r,c=encodeNumberID(d,a.substr(0,3),s);return c}function b64_hmac_sha1(e,t){return binb2b64(core_hmac_sha1(e,t))}function core_sha1(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var n=Array(80),i=1732584193,a=-271733879,s=-1732584194,r=271733878,d=-1009589776,c=0;c<e.length;c+=16){for(var o=i,_=a,p=s,h=r,u=d,g=0;80>g;g++){n[g]=16>g?e[c+g]:rol(n[g-3]^n[g-8]^n[g-14]^n[g-16],1);var f=safe_add(safe_add(rol(i,5),sha1_ft(g,a,s,r)),safe_add(safe_add(d,n[g]),sha1_kt(g)));d=r,r=s,s=rol(a,30),a=i,i=f}i=safe_add(i,o),a=safe_add(a,_),s=safe_add(s,p),r=safe_add(r,h),d=safe_add(d,u)}return Array(i,a,s,r,d)}function sha1_ft(e,t,n,i){return 20>e?t&n|~t&i:40>e?t^n^i:60>e?t&n|t&i|n&i:t^n^i}function sha1_kt(e){return 20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514}function core_hmac_sha1(e,t){var n=str2binb(e);n.length>16&&(n=core_sha1(n,e.length*chrsz));for(var i=Array(16),a=Array(16),s=0;16>s;s++)i[s]=909522486^n[s],a[s]=1549556828^n[s];var r=core_sha1(i.concat(str2binb(t)),512+t.length*chrsz);return core_sha1(a.concat(r),672)}function safe_add(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function rol(e,t){return e<<t|e>>>32-t}function str2binb(e){for(var t=Array(),n=(1<<chrsz)-1,i=0;i<e.length*chrsz;i+=chrsz)t[i>>5]|=(e.charCodeAt(i/chrsz)&n)<<32-chrsz-i%32;return t}function binb2b64(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",i=0;i<4*e.length;i+=3)for(var a=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,s=0;4>s;s++)n+=8*i+6*s>32*e.length?b64pad:t.charAt(a>>6*(3-s)&63);return n}var TSCObject=function(e){this.p_device_id,this.p_device_id_time,this.p_session_id,this.p_time_offset,this.p_schedule_fun_id,this.p_tsc_code_fun_id,this.p_check_did_fun_id,this.p_relogin_schedule=9e5,this.p_partnerCode,this.p_appId,this.p_externalId,this.p_sdc_version="10",this.p_api_type,this.qr_options={},this.cloud_app_key="de82967019906571ae879c460358e148",e&&(this.qr_options=e)};TSCObject.prototype.init=function(e,t,n,i,a){this.p_partnerCode=e,this.p_appId=t,this.p_externalId=n,this.p_api_type=i,this.cloud_app_key=a,this.p_session_id=this.getSessionId();var s=(new Date).getTime(),r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src="https://pws.payegis.com.cn/did/js/dp.js?appId="+this.p_appId+"&sessionId="+this.p_session_id+"&ts="+s,document.getElementsByTagName("body")[0].appendChild(r)},TSCObject.prototype.getSessionId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})},TSCObject.prototype.requestDid=function(e){var t=document.createElement("script"),n=(new Date).getTime();t.type="text/javascript";var i="appId="+e.p_appId+"&callback=didCallback&sessionId="+e.p_session_id+"&x-hmac-auth-date="+n,a=e.p_appId+":"+encodeURIComponent(e.sig(i));t.src="https://pws.payegis.com.cn/did/rest/device/devicePrintId?appId="+this.p_appId+"&sessionId="+this.p_session_id+"&callback=didCallback&sig="+a+"&ts="+n,document.getElementsByTagName("body")[0].appendChild(t)},TSCObject.prototype.generateTscCode=function(){var e=this;this.p_device_id_time=setInterval(function(){e.requestDid(e)},1e3),(null==TSCObject.p_device_id||""==TSCObject.p_device_id||"undefined"==TSCObject.p_device_id)&&(this.p_check_did_fun_id=setInterval(function(){e.beforeDidEnd(e)},500)),this.p_schedule_fun_id=setInterval(function(){e.tscFunc()},this.p_relogin_schedule)},TSCObject.prototype.tscFunc=function(){this.synctime(this),this.sdc_login(this)},TSCObject.prototype.beforeDidEnd=function(e){null!=e.p_device_id&&""!=e.p_device_id&&"undefined"!=e.p_device_id&&(clearInterval(e.p_check_did_fun_id),this.synctime(e),this.sdc_login(e))},TSCObject.prototype.sig=function(e){var t=encodeURIComponent(e);return t=t.replace("*","%2A"),t=t.replace(" ","%20"),b64_hmac_sha1(this.cloud_app_key+"&",t)},TSCObject.prototype.synctime=function(e){var t=(new Date).getTime(),n="t="+t+"&x-hmac-auth-date="+t,i=e.p_appId+":"+this.sig(n),a="https://pws.payegis.com.cn/tsc/rest/client/synctimeForWeb?t="+t;jQuery.ajax({async:!1,url:a,dataType:"jsonp",jsonp:"jsoncallback",type:"GET",data:{"x-hmac-auth-date":t,"x-hmac-auth-signature":i},success:function(t){var n=""+(new Date).getTime();e.p_time_offset=n.substring(0,n.length-3)-t.data.timestamp}})},TSCObject.prototype.sdc_login=function(e){var t=(new Date).getTime(),n="appId="+e.p_appId+"&appPartner="+e.p_partnerCode+"&deviceId="+e.p_device_id+"&externalId="+e.p_externalId+"&t="+t+"&x-hmac-auth-date="+t,i=e.p_appId+":"+this.sig(n),a="https://pws.payegis.com.cn/tsc/rest/authority/userbindForWeb?t="+t;jQuery.ajax({url:a,dataType:"jsonp",jsonp:"jsoncallback",data:{appId:e.p_appId,appPartner:e.p_partnerCode,deviceId:e.p_device_id,externalId:e.p_externalId,"x-hmac-auth-date":t,"x-hmac-auth-signature":i},type:"GET",success:function(t){var n=t.data.uid;clearInterval(e.p_tsc_code_fun_id),e.p_tsc_code_fun_id=doGenerate(e.p_api_type,e.p_device_id,n,e.p_partnerCode,e.p_time_offset,e.p_sdc_version,e.qr_options)}})},TSCObject.prototype.setDeviceId=function(e){this.p_device_id=e};var tscSdkObj,g_PGS_Type="",g_PGS_DeviceId="",g_PGS_UserToken="",g_PGS_PartCode="",g_PGS_TimeOffset=0,g_PGS_Version="",g_PGS_Width=256,g_PGS_Height=256,g_options={},hexcase=0,b64pad="=",chrsz=8;