{"version":3,"sources":["/components/utils/ajax.jsx"],"names":[],"mappings":"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","file":"/components/utils/ajax.jsx","sourcesContent":["/*\n对ajax层进行一次封装，便于统一处理请求的成功、失败和登录跳转逻辑\n同时也可以统一ajax的用法，不会根据用的什么库修改发送ajax的逻辑，\n统一在这里修改就行\n*/\nimport { Message } from 'element-ui';\n\nwindow.__disableNativeFetch=true;\n\nvar fetch = require('fetch-ie8');\n\n\nvar successCode=\"1\",\n\tfailCode=\"0\",\n\tnotLoginCode=\"-99\";\n\n\nfunction ajax(url,data,successCallback,completeCallback,method,faillCallback,dataType,processData,headers){\n\tvar dataType=dataType||\"json\";\n\tvar method=method||\"post\";\n\tvar processData=processData||true;\n\n\tif(processData){\n\t\tif(typeof data != \"string\"){\n\t\t\tdata=urlParamsObjTranslator(data);\n\t\t}\n\t}\n\tvar fetchResult=fetch(url+(method==\"get\"?\"?\"+data:\"\"), {\n\t  method: method,\n\t  headers: headers,\n\t  body: method==\"post\"?data:\"\"\n\t}).then(status)\n\t  .then(json)\n\t  .then(function(json) {\n\t    console.log('request succeeded with json response', json);\n\t    if(String(json.status) === successCode){\n\t    \tsuccessCallback&&successCallback(json);\n\t    }else if(String(json.status) === failCode){\n\t    \tif(typeof faillCallback === \"function\"){\n\t\t\t\tfaillCallback&&faillCallback(json);\n\t\t\t}else{\n\t\t\t\tMessage(json.detail||json.message||json.msg||\"请求失败！\");\n\t\t\t}\n\t    }else if(String(json.status) === notLoginCode){\n\t    \tif(window.loginUrl){\n\t    \t\twindow.location.href=window.loginUrl;\n\t    \t}\n\t    }else{\n\t    \tconsole.log('未识别的status码：', json.status)\n\t    }\n\n\t    completeCallback&&completeCallback(json);\n\t    \n\t  }).catch(function(error) {\n\t    console.log('request failed', error)\n\t  })\n\n\tfunction status(response) {\n\t  if (response.status >= 200 && response.status < 300) {\n\t    return response\n\t  }\n\t  throw new Error(response.statusText)\n\t}\n\n\tfunction json(response) {\n\t\tif(dataType==\"json\"){\n\t\t    return response.json()\n\t\t}else{\n\t\t\treturn response;\n\t\t}\n\t}\n\n\treturn fetchResult;\n}\n\nfunction urlParamsObjTranslator(data,type){\n    var type=type||'objToUrl';\n    var result=null;\n\n    if(type=='urlToObj'){\n        //a=1&b=2&c=3  =>  {a:1,b:2,c:3}\n        if(typeof data == 'string'){\n            var dataArray=data.split('&');\n            result={};\n            for(var i=0;i<dataArray.length;i++){\n                var dataStr=dataArray[i],\n                    dataKey=dataStr.split('=')[0],\n                    dataValue=dataStr.split('=')[1];\n\n                result[dataKey]=dataValue;\n            }\n        }else{\n            console.log('urlToObj方式，data必须为a=x&b=xx格式字符串');\n        }\n    }else{\n        //objToUrl方式 {a:1,b:2,c:3}  => a=1&b=2&c=3\n        result=[];\n        if(typeof data == 'object') {\n            for (var key in data) {\n            \tif(data[key]){\n            \t\t//如果值不存在，则不放在请求参数里，todo 可能需要改\n                    //防止发送的参数值有特殊字符导致发送请求的时候丢失，需要encodeURIComponent处理一下\n                    var tmpStr=key+'='+encodeURIComponent(data[key]);\n                    result.push(tmpStr);\n\t\t\t\t}\n            }\n            result=result.join('&');\n        }else{\n            console.log('objToUrl方式，data必须为对象！');\n        }\n    }\n\n    return result;\n}\n\nexport default ajax;"]}